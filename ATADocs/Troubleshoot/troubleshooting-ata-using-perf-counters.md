---
# required metadata

title: パフォーマンス カウンターを使用した ATA のトラブル シューティング | Microsoft Advanced Threat Analytics
description: パフォーマンス カウンターを使用して ATA の問題をトラブルシューティングする方法について説明します。
keywords:
author: rkarlin
manager: stevenpo
ms.date: 04/28/2016
ms.topic: article
ms.prod: identity-ata
ms.service: advanced-threat-analytics
ms.technology: security
ms.assetid: df162a62-f273-4465-9887-94271f5000d2

# optional metadata

#ROBOTS:
#audience:
#ms.devlang:
ms.reviewer: bennyl
ms.suite: ems
#ms.tgt_pltfrm:
#ms.custom:

---

# パフォーマンス カウンターを使用した ATA のトラブル シューティング
ATA パフォーマンス カウンターは、ATA の各コンポーネントの実行状態の詳細を示します。 ATA コンポーネントはデータを順次処理するため、何か問題があった場合には、トラフィックの破棄を引き起こす連鎖反応が起こります。 問題を解決するには、該当するコンポーネントを特定して、一連の問題を解決していく必要があります。
内部 ATA コンポーネントのフローを理解するには、「[ATA アーキテクチャ](/advanced-threat-analytics/plan-design/ata-architecture)」を参照してください。

**ATA コンポーネントの処理**:

1.  コンポーネントは、その最大サイズに達すると、前のコンポーネントがそれ以上エンティティを送信することをブロックします。

2.  次に、前のコンポーネントは、**そのコンポーネント自体の**サイズの拡大を開始し、さらに前にあるコンポーネントによるエンティティの送信をブロックします。

3.  この動作が最初の NetworkListener コンポーネントに至るまでさかのぼって実行され、最初のコンポーネントはエンティティを転送できなくなった時点でトラフィックを破棄します。

4. パフォーマンス カウンターに含まれるデータを使用して、各コンポーネントがどのように機能しているかを理解します。 

## ATA ゲートウェイのパフォーマンス カウンター

このセクションでの ATA ゲートウェイに関する記述は、すべて ATA 簡易ゲートウェイにも該当します。

ATA ゲートウェイのパフォーマンス カウンターを追加することで、ATA ゲートウェイのパフォーマンス状態をリアルタイムで観察できます。
これは、[パフォーマンス モニター] を開き、ATA ゲートウェイ用のすべてのカウンターを追加することで実行します。 パフォーマンス カウンター オブジェクトの名前は "Microsoft ATA Gateway" です。

![パフォーマンス カウンターの追加のイメージ](media/ATA-performance-counters.png)

注目すべき ATA ゲートウェイの主要なカウンターの一覧を次に示します。

|カウンター|説明|しきい値|トラブルシューティング|
|-----------|---------------|-------------|-------------------|
|NetworkListener PEF パーサー メッセージ/秒|ATA ゲートウェイによって 1 秒間に処理されたトラフィックの量。|しきい値なし|ATA ゲートウェイによって解析されたトラフィックの量を理解するのに役立ちます。|
|NetworkListener PEF 破棄されたイベント/秒|ATA ゲートウェイによって 1 秒間に破棄されたトラフィックの量。|この数値は常にゼロである必要があります (まれに発生することがある突発的な破棄は容認できます)。|NetworkListener に至るまでのコンポーネントで、最大サイズに達したために前のコンポーネントをブロックしているコンポーネントがあるかどうかを確認します。 前述の「**ATA コンポーネントの処理**」を参照してください。<br /><br />CPU またはメモリに問題がないことを確認します。|
|NetworkListener ETW 破棄されたイベント/秒|ATA ゲートウェイによって 1 秒間に破棄されたトラフィックの量。|この数値は常にゼロである必要があります (まれに発生することがある突発的な破棄は容認できます)。|NetworkListener に至るまでのコンポーネントで、最大サイズに達したために前のコンポーネントをブロックしているコンポーネントがあるかどうかを確認します。 前述の「**ATA コンポーネントの処理**」を参照してください。<br /><br />CPU またはメモリに問題がないことを確認します。|
|NetworkActivityTranslator メッセージ データ # ブロック サイズ|ネットワーク アクティビティ (NA) に変換するためにキュー処理されたトラフィックの量。|最大値 - 1 である必要があります (既定の最大値: 100,000)|NetworkListener に至るまでのコンポーネントで、最大サイズに達したために前のコンポーネントをブロックしているコンポーネントがあるかどうかを確認します。 前述の「**ATA コンポーネントの処理**」を参照してください。<br /><br />CPU またはメモリに問題がないことを確認します。|
|EntityResolver アクティビティのブロック サイズ|解決するためにキュー処理されたネットワーク アクティビティ (NA) の量。|最大値 - 1 である必要があります (既定の最大値: 10,000)|NetworkListener に至るまでのコンポーネントで、最大サイズに達したために前のコンポーネントをブロックしているコンポーネントがあるかどうかを確認します。 前述の「**ATA コンポーネントの処理**」を参照してください。<br /><br />CPU またはメモリに問題がないことを確認します。|
|EntitySender エンティティ バッチのブロック サイズ|ATA センターに送信するためにキュー処理されたネットワーク アクティビティ (NA) の量。|最大値 - 1 である必要があります (既定の最大値: 1,000,000)|NetworkListener に至るまでのコンポーネントで、最大サイズに達したために前のコンポーネントをブロックしているコンポーネントがあるかどうかを確認します。 前述の「**ATA コンポーネントの処理**」を参照してください。<br /><br />CPU またはメモリに問題がないことを確認します。|
|EntitySender バッチ送信時間|最後のバッチを送信するためにかかった時間。|ほとんどの場合、1000 ミリ秒未満である必要があります。|ATA ゲートウェイと ATA センターの間に問題があるかどうかを確認します。|

> [!NOTE]
> -   計時カウンターはミリ秒単位です。
> -   グラフの種類として "レポート" を使用して、すべてのカウンターをモニターするほうが便利な場合があります (例: すべてのカウンターのリアルタイム監視)。

## ATA センターのパフォーマンス カウンター
ATA センターのパフォーマンス カウンターを追加することで、ATA センターのパフォーマンス状態をリアルタイムで観察できます。

これは、[パフォーマンス モニター] を開き、ATA センター用のすべてのカウンターを追加することで実行します。 パフォーマンス カウンター オブジェクトの名前は "Microsoft ATA Center" です。

![ATA センターのパフォーマンス カウンターの追加](media/ATA-Gateway-perf-counters.png)

注目すべき ATA センターの主要なカウンターの一覧を次に示します。

|カウンター|説明|しきい値|トラブルシューティング|
|-----------|---------------|-------------|-------------------|
|EntityReceiver エンティティ バッチのブロック サイズ|ATA センターによってキュー処理されたエンティティ バッチの数。|最大値 - 1 である必要があります (既定の最大値: 10,000)|NetworkListener に至るまでのコンポーネントで、最大サイズに達したために前のコンポーネントをブロックしているコンポーネントがあるかどうかを確認します。  前述の「**ATA コンポーネントの処理**」を参照してください。<br /><br />CPU またはメモリに問題がないことを確認します。|
|NetworkActivityProcessor ネットワーク アクティビティのブロック サイズ|処理するためにキュー処理されたネットワーク アクティビティ (NA) の数。|最大値 - 1 である必要があります (既定の最大値: 50,000)|NetworkListener に至るまでのコンポーネントで、最大サイズに達したために前のコンポーネントをブロックしているコンポーネントがあるかどうかを確認します。 前述の「**ATA コンポーネントの処理**」を参照してください。<br /><br />CPU またはメモリに問題がないことを確認します。|
|EntityProfiler ネットワーク アクティビティのブロック サイズ|プロファイリングするためにキュー処理されたネットワーク アクティビティ (NA) の数。|最大値 - 1 である必要があります (既定の最大値: 10,000)|NetworkListener に至るまでのコンポーネントで、最大サイズに達したために前のコンポーネントをブロックしているコンポーネントがあるかどうかを確認します。 前述の「**ATA コンポーネントの処理**」を参照してください。<br /><br />CPU またはメモリに問題がないことを確認します。|
|CenterDatabase &#42; ブロック サイズ|データベースに書き込むためにキュー処理された特定の種類のネットワーク アクティビティの数。|最大値 - 1 である必要があります (既定の最大値: 50,000)|NetworkListener に至るまでのコンポーネントで、最大サイズに達したために前のコンポーネントをブロックしているコンポーネントがあるかどうかを確認します。 前述の「**ATA コンポーネントの処理**」を参照してください。<br /><br />CPU またはメモリに問題がないことを確認します。|


> [!NOTE]
> -   計時カウンターはミリ秒単位です。
> -   グラフの種類としてレポートを使用して、すべてのカウンターをモニターするほうが便利な場合があります (例: すべてのカウンターのリアルタイム監視)。

## オペレーティング システムのカウンター
注目すべきオペレーティング システムの主要なカウンターの一覧を次に示します：

|カウンター|説明|しきい値|トラブルシューティング|
|-----------|---------------|-------------|-------------------|
|Processor(_Total)\% プロセッサ時間|プロセッサが非アイドルのスレッドを実行するための経過時間の割合です。|平均して 80% 未満|必要以上にプロセッサ時間を取っている特定のプロセスがあるかどうかを確認します。<br /><br />プロセッサを追加します。<br /><br />サーバーごとのトラフィックの量を削減します。<br /><br />"Processor(_Total)\% プロセッサ時間" カウンターは、仮想サーバーでは精度が低くなる可能性があります。この場合にプロセッサーの能力の欠如を測定するための精度を高める方法は、"System\プロセッサ キューの長さ" カウンターを使用することです。|
|System\コンテキスト切り替え/秒|すべてのプロセッサがあるスレッドから別のスレッドに切り替わる統合された率。|5000&#42; コア未満 (物理コア)|必要以上にプロセッサ時間を取っている特定のプロセスがあるかどうかを確認します。<br /><br />プロセッサを追加します。<br /><br />サーバーごとのトラフィックの量を削減します。<br /><br />"Processor(_Total)\% プロセッサ時間" カウンターは、仮想サーバーでは精度が低くなる可能性があります。この場合にプロセッサーの能力の欠如を測定するための精度を高める方法は、"System\プロセッサ キューの長さ" カウンターを使用することです。|
|System\プロセッサ キューの長さ|実行する準備が整い、スケジュールされるように待機しているスレッドの数。|5&#42; コア未満 (物理コア)|必要以上にプロセッサ時間を取っている特定のプロセスがあるかどうかを確認します。<br /><br />プロセッサを追加します。<br /><br />サーバーごとのトラフィックの量を削減します。<br /><br />"Processor(_Total)\% プロセッサ時間" カウンターは、仮想サーバーでは精度が低くなる可能性があります。この場合にプロセッサーの能力の欠如を測定するための精度を高める方法は、"System\プロセッサ キューの長さ" カウンターを使用することです。|
|Memory\使用可能バイト (MB)|割り当てるために利用できる物理メモリ (RAM) の量。|512 以上である必要があります|必要以上に物理メモリを使用している特定のプロセスがあるかどうかを確認します。<br /><br />物理メモリの量を増やします。<br /><br />サーバーごとのトラフィックの量を削減します。|
|LogicalDisk(&#42;)\平均 Disk sec/Read を収集します|ディスクからデータを読み取るための平均遅延時間 (インスタンスとしてデータベース ドライブを選択する必要があります)。|10 ミリ秒未満である必要があります|必要以上にデータベース ドライブを使用している特定のプロセスがあるかどうかを確認します。<br /><br />このドライブが 10 ms 未満の遅延時間で現在のワークロードに対応できるかどうかをストレージ チーム/ベンダーに確認してください。 現在のワークロードは、ディスク使用率カウンターを使用して確認できます。|
|LogicalDisk(&#42;)\平均 ディスク書き込み秒数|ディスクにデータを書き込むための平均遅延時間 (インスタンスとしてデータベース ドライブを選択する必要があります)。|10 ミリ秒未満である必要があります|必要以上にデータベース ドライブを使用している特定のプロセスがあるかどうかを確認します。<br /><br />このドライブが 10 ms 未満の遅延時間で現在のワークロードに対応できるかどうかをストレージ チーム/ベンダーに確認してください。 現在のワークロードは、ディスク使用率カウンターを使用して確認できます。|
|\LogicalDisk(&#42;)\ディスク読み取り/秒|ディスクに対する読み取り操作の実行率。|しきい値なし|ディスク使用率カウンターは、ストレージの遅延をトラブルシューティングするときに、詳細を得るために役立ちます。|
|\LogicalDisk(&#42;)\ディスク読み取りバイト/秒|ディスクから読み取られる 1 秒あたりのバイト数。|しきい値なし|ディスク使用率カウンターは、ストレージの遅延をトラブルシューティングするときに、詳細を得るために役立ちます。|
|\LogicalDisk(&#42;)\ディスク書き込み/秒|ディスクに対する書き込み操作の実行率。|しきい値なし|ディスク使用率カウンター (ストレージの遅延をトラブルシューティングするときに、詳細を得るために役立ちます)|
|\LogicalDisk(&#42;)\ディスク書き込みバイト/秒|ディスクに書き込まれる 1 秒あたりのバイト数。|しきい値なし|ディスク使用率カウンターは、ストレージの遅延をトラブルシューティングするときに、詳細を得るために役立ちます。|

## 関連項目
- [ATA の前提条件](/advanced-threat-analytics/plan-design/ata-prerequisites)
- [ATA 容量計画](/advanced-threat-analytics/plan-design/ata-capacity-planning)
- [イベント コレクションの構成](/advanced-threat-analytics/deploy-use/configure-event-collection)
- [Windows イベント転送を構成する](/advanced-threat-analytics/deploy-use/configure-event-collection#configuring-windows-event-forwarding)
- [ATA フォーラムを確認してください。](https://social.technet.microsoft.com/Forums/security/en-US/home?forum=mata)


<!--HONumber=May16_HO3-->


